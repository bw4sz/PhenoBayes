---
title: 'Pollinator mediated competition: Comparing traits and environment in reducing phenology overlap of cloud forest plants.'
author: "Ben Weinstein"
date: "Monday, October 13, 2014"
output:
  html_document:
    toc: true
    number_sections: true
    theme: readable
---

# Abstract
Cloud forest plant assemblages are among the richness worldwide. Hummingbird visited plants make up a large percentage of the plant assemblage. Previous work has shown that hummingbirds feed on plants that match corollas based on bill length. This suggests that plants with similiar corolla morphologies compete for pollination resources. To minimize competition between species, as well as decrease amount of pollen loss due to heterospecific transfer, there should be selection for minimal overlap in flowering timing. While this has been evaluated within a single genus (Stiles 1975) there has been little work in combining relatedness, environment and morphology in a single framework. My goal is to compare the effect of morphology of competiting species on the abuncance of flowers along a wide elevation gradient. 

# Introduction

## Data

We collected flower abundance for hummingbird visited flowers along a 1300m elevation gradient in northern ecuador.

<img src="https://lh5.googleusercontent.com/-A_IrguUUUxo/UhskPLhTGKI/AAAAAAAABEA/njPD9WiSGVk/w958-h773-no/IMG_8612.JPG" alt="Drawing" style="width: 300px;"/><img src="https://lh5.googleusercontent.com/-D44D4F1HuNI/UhspjAOzG1I/AAAAAAAABT8/JVNkMBYXP8c/w958-h719-no/P7241696.JPG" alt="Drawing" style="width: 300px;"/> <img src="https://lh6.googleusercontent.com/YiT6fbrpCztsEGtqRwqVKeIXNBSiVCtyACY5yWbiFfE=w958-h719-no" alt="Drawing" style="width: 300px;"/>


We measured three flower morphology traits for each species: corolla width, corolla length and height of plant from ground.

<center> <img src="https://lh3.googleusercontent.com/-dU3zsYfwwtY/UhspWyi-SwI/AAAAAAAABTU/zJi1HCe3O24/w958-h719-no/P7211629.JPG" alt="Drawing" style="width: 300px;"/> </center>


```{r,echo=FALSE,warning=FALSE,message=FALSE,d}
require(knitr)
require(ggplot2)
require(plyr)
require(vegan)
require(picante)
require(xtable)
opts_chunk$set(warning=FALSE,message=FALSE,dpi=300)
```

```{r,echo=FALSE,dpi=50}
dat<-read.csv("C:/Users/Ben/Dropbox/Thesis/Maquipucuna_SantaLucia/Results/FlowerTransects/CleanedHolgerTransect.csv",row.names=1)
ggplot(dat,aes(x=Total_Flowers)) + geom_histogram() + ggtitle("Histogram of Flower Abundance")
ggplot(dat,aes(x=log(Total_Flowers))) + geom_histogram() + ggtitle("Histogram of Log Abundance")
```

## Seasonality
Flower abundance changes throughout the year and along the elevation gradient.

![](C:\Users\Ben\Dropbox\Thesis\Maquipucuna_SantaLucia\Results\FlowerTransects\FlowerElevations_Holger.jpeg)

#Model Formulation

$$Abundance \sim Elevation + Julian Day + Error$$

\[Error \sim \text {Morphology of Co-occurring Species}\]

The goal of the analysis is to measure the effect of this error term on shaping abundance of species flowers. Additional analysis could also look at elevation/distance to a conspecific as promoting abundance. 

The abundance of plants is models as a log normal distribution instead of a poisson to have control over the variance term.

\[Abundance \sim LogN(\mu,\sigma) \]


##Outline of Steps
This analysis needs to broken down into several tractable steps.

1. Model of all plants abundance as a function of intercept + elevation
$$Abundance \sim  LogN(\mu,\sigma) $$

$$\mu \sim Intercept + \beta_1 * Elevation $$

\[intercept \sim N(0,.0001) \] 
\[\beta_1 \sim N(0,.0001) \] 
\[\sigma \sim Gamma(0.0001,.0001) \] 

Sigma is drawn as a gamma, because the conjugate of lognormal is a gamma.Hopefully this will help convergence.

2. Model of all plants abundance as a function of intercept + elevation + Julian Day. The Julian day needs to be transformed?

$$Abundance \sim  LogN(\mu,\sigma) $$

$$\mu \sim Intercept + \beta_1 * Elevation + \beta_2 * \text{Julian Day}. $$

\[intercept \sim N(0,.0001) \] 
\[\beta_1 \sim N(0,.0001) \] 
\[\sigma \sim Gamma(0.0001,.0001) \] 
$$ \text{Julian Day} \sim U(0,365) $$
\[\beta_2 \sim N(0,.0001) \] 


3. Model of all plants abundance as a function of intercept + elevation + Julian Day. Sigma is modeled as function of Morphology of co-occurring species. This now considered a hierichical model. 

$$Abundance \sim  LogN(\mu,\sigma) $$

$$\mu \sim Intercept + \beta_1 * Elevation + \beta_2 * \text{Julian Day}. $$

\[intercept \sim N(0,.0001) \] 
\[\beta_1 \sim N(0,.0001) \] 
$$ \text{Julian Day} \sim U(0,365) $$
\[\beta_2 \sim N(0,.0001) \] 

With the errors:
\[\sigma \sim Gamma(lambda,.001)\]
$$ \lambda \sim Intercept + \beta_3 * \text{Morphology of Co-occurring Species}$$
$$ \beta_3 \sim N(0,0.0001)$$

4. Model of all plants abundance as a function of intercept + elevation + Julian Day. Sigma is modeled as function of Morphology of co-occurring species. A random effect of species is added for each species. Where does this go!